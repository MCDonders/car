#!/bin/sh

export DBUS_SESSION_BUS_ADDRESS='unix:path=/var/run/dbus/session_bus_socket'

MSG_REMOUNT="0","128","1","0","0","7","0","4","0","0","0","4","4","51","0","11","0","0","128","4","72","84","45","53","51","0","15","1","0","128","8","114","101","45","109","111","117","110","116","51","0","16","2","0","128","9","114","111","111","116","102","115","46","46","46","51","0","7","3","0","128","0"
MSG_REMOUNT_FAILED="0","128","1","0","0","7","0","4","0","0","0","4","4","51","0","11","0","0","128","4","72","84","45","53","51","0","15","1","0","128","8","114","101","45","109","111","117","110","116","51","0","13","2","0","128","6","114","111","111","116","102","115","51","0","14","3","0","128","7","102","97","105","108","101","100","33",
MSG_ADDING_R00T="0","128","1","0","0","7","0","4","0","0","0","4","4","51","0","11","0","0","128","4","72","84","45","53","51","0","13","1","0","128","6","97","100","100","105","110","103","51","0","16","2","0","128","9","114","48","48","116","32","117","115","101","114","51","0","10","3","0","128","3","46","46","46",
MSG_ADDING_R00T_FAILED="0","128","1","0","0","7","0","4","0","0","0","4","4","51","0","11","0","0","128","4","72","84","45","53","51","0","13","1","0","128","6","97","100","100","105","110","103","51","0","16","2","0","128","9","114","48","48","116","32","117","115","101","114","51","0","14","3","0","128","7","102","97","105","108","101","100","33",
MSG_CLEANING_UP="0","128","1","0","0","7","0","4","0","0","0","4","4","51","0","11","0","0","128","4","72","84","45","53","51","0","7","1","0","128","0","51","0","21","2","0","128","14","99","108","101","97","110","105","110","103","32","117","112","46","46","46","51","0","7","3","0","128","0",
MSG_DONE="0","128","1","0","0","7","0","4","0","0","0","4","4","51","0","11","0","0","128","4","72","84","45","53","51","0","12","1","0","128","5","68","79","78","69","46","51","0","7","2","0","128","0","51","0","7","3","0","128","0",

show()
{
        dbus-send --type=method_call --dest=com.nokia.s12xrouter /com/nokia/s12xrouter com.nokia.s12xrouter.BapKPB.ScreenData array:byte:$1
}

getent passwd r00t || (
        show $MSG_REMOUNT
        mount / -o remount,rw || ( show $MSG_REMOUNT_FAILED; exit 1; )
        show $MSG_ADDING_R00T
        useradd -ou 0 -d /root -s /bin/sh -p '' -g root r00t || ( show $MSG_ADDING_R00T_FAILED; exit 1; )
        show $MSG_CLEANING_UP
        mount / -o remount,ro
)

show $MSG_DONE

# note, changing this re-sets the USB port, so our mass storage device goes away.
#sleep 100
#echo "rndis" > /sys/devices/platform/pxa-u2o/composite
